<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chess Learning App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .chess-square {
            width: 12.5%;
            height: 12.5%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            position: relative;
        }
        .chess-piece {
            font-size: 2rem;
            font-weight: bold;
            user-select: none;
        }
        .valid-move {
            position: absolute;
            width: 20px;
            height: 20px;
            background: green;
            border-radius: 50%;
            opacity: 0.8;
        }
        @media (max-width: 640px) {
            .chess-piece {
                font-size: 1.5rem;
            }
            .valid-move {
                width: 15px;
                height: 15px;
            }
        }
    </style>
</head>
<body class="min-h-screen bg-orange-100 p-4">
    <div class="max-w-4xl mx-auto">
        <!-- Header -->
        <div class="text-center mb-6">
            <h1 class="text-3xl font-bold text-amber-900 mb-2">Chess Game</h1>
            <p id="gameStatus" class="text-lg text-amber-700">White to move</p>
        </div>

        <!-- Game Controls -->
        <div class="flex justify-center gap-4 mb-6">
            <button onclick="resetBoard()" class="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700">
                New Game
            </button>
            <button onclick="flipBoard()" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">
                Flip Board
            </button>
        </div>

        <!-- Board Container -->
        <div class="flex justify-center">
            <div id="chessBoard" class="w-full max-w-md aspect-square border-4 border-gray-800 bg-gray-900 p-2 rounded-lg shadow-2xl">
                <!-- Board will be generated by JavaScript -->
            </div>
        </div>

        <!-- Promotion Dialog -->
        <div id="promotionDialog" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4 hidden">
            <div class="bg-white p-6 rounded-lg max-w-sm w-full">
                <h3 class="text-lg font-bold mb-4 text-center">Choose Promotion Piece</h3>
                <div class="grid grid-cols-4 gap-2">
                    <button onclick="promotePiece('queen')" class="aspect-square text-2xl border rounded hover:bg-gray-100">♕</button>
                    <button onclick="promotePiece('rook')" class="aspect-square text-2xl border rounded hover:bg-gray-100">♖</button>
                    <button onclick="promotePiece('bishop')" class="aspect-square text-2xl border rounded hover:bg-gray-100">♗</button>
                    <button onclick="promotePiece('knight')" class="aspect-square text-2xl border rounded hover:bg-gray-100">♘</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Chess game logic
        const PIECE_SYMBOLS = {
            white: { pawn: "♙", rook: "♖", knight: "♘", bishop: "♗", queen: "♕", king: "♔" },
            black: { pawn: "♟", rook: "♜", knight: "♞", bishop: "♝", queen: "♛", king: "♚" }
        };

        let board = [];
        let selectedSquare = null;
        let validMoves = [];
        let currentPlayer = 'white';
        let isFlipped = false;
        let promotionSquare = null;

        function createInitialBoard() {
            const board = Array(8).fill(null).map(() => Array(8).fill(null));
            
            // White pieces
            board[7] = [
                { type: "rook", color: "white" },
                { type: "knight", color: "white" },
                { type: "bishop", color: "white" },
                { type: "queen", color: "white" },
                { type: "king", color: "white" },
                { type: "bishop", color: "white" },
                { type: "knight", color: "white" },
                { type: "rook", color: "white" }
            ];
            for (let i = 0; i < 8; i++) board[6][i] = { type: "pawn", color: "white" };

            // Black pieces
            board[0] = [
                { type: "rook", color: "black" },
                { type: "knight", color: "black" },
                { type: "bishop", color: "black" },
                { type: "queen", color: "black" },
                { type: "king", color: "black" },
                { type: "bishop", color: "black" },
                { type: "knight", color: "black" },
                { type: "rook", color: "black" }
            ];
            for (let i = 0; i < 8; i++) board[1][i] = { type: "pawn", color: "black" };

            return board;
        }

        function isValidMove(board, fromRow, fromCol, toRow, toCol) {
            const piece = board[fromRow][fromCol];
            if (!piece) return false;

            const targetPiece = board[toRow][toCol];
            if (targetPiece?.color === piece.color) return false;

            const rowDiff = toRow - fromRow;
            const colDiff = toCol - fromCol;
            const absRowDiff = Math.abs(rowDiff);
            const absColDiff = Math.abs(colDiff);

            switch (piece.type) {
                case "pawn":
                    const direction = piece.color === "white" ? -1 : 1;
                    const startRow = piece.color === "white" ? 6 : 1;

                    if (colDiff === 0) {
                        if (rowDiff === direction && !targetPiece) return true;
                        if (fromRow === startRow && rowDiff === 2 * direction && !targetPiece && !board[fromRow + direction][fromCol])
                            return true;
                    } else if (absColDiff === 1 && rowDiff === direction) {
                        return !!targetPiece;
                    }
                    return false;

                case "rook":
                    if (rowDiff !== 0 && colDiff !== 0) return false;
                    break;

                case "knight":
                    return (absRowDiff === 2 && absColDiff === 1) || (absRowDiff === 1 && absColDiff === 2);

                case "bishop":
                    if (absRowDiff !== absColDiff) return false;
                    break;

                case "queen":
                    if (rowDiff !== 0 && colDiff !== 0 && absRowDiff !== absColDiff) return false;
                    break;

                case "king":
                    return absRowDiff <= 1 && absColDiff <= 1;
            }

            // Check path for sliding pieces
            if (piece.type === "rook" || piece.type === "bishop" || piece.type === "queen") {
                const stepRow = rowDiff === 0 ? 0 : rowDiff > 0 ? 1 : -1;
                const stepCol = colDiff === 0 ? 0 : colDiff > 0 ? 1 : -1;
                let checkRow = fromRow + stepRow;
                let checkCol = fromCol + stepCol;

                while (checkRow !== toRow || checkCol !== toCol) {
                    if (board[checkRow][checkCol]) return false;
                    checkRow += stepRow;
                    checkCol += stepCol;
                }
            }

            return true;
        }

        function getValidMoves(board, row, col) {
            const piece = board[row][col];
            if (!piece) return [];

            const moves = [];
            for (let toRow = 0; toRow < 8; toRow++) {
                for (let toCol = 0; toCol < 8; toCol++) {
                    if (isValidMove(board, row, col, toRow, toCol)) {
                        const testBoard = board.map(r => [...r]);
                        testBoard[toRow][toCol] = testBoard[row][col];
                        testBoard[row][col] = null;
                        moves.push([toRow, toCol]);
                    }
                }
            }
            return moves;
        }

        function renderBoard() {
            const boardElement = document.getElementById('chessBoard');
            boardElement.innerHTML = '';
            
            for (let row = 0; row < 8; row++) {
                for (let col = 0; col < 8; col++) {
                    const displayRow = isFlipped ? 7 - row : row;
                    const displayCol = isFlipped ? 7 - col : col;
                    
                    const piece = board[displayRow][displayCol];
                    const isLight = (displayRow + displayCol) % 2 === 0;
                    const isSelected = selectedSquare && selectedSquare[0] === displayRow && selectedSquare[1] === displayCol;
                    const isValidMove = validMoves.some(([r, c]) => r === displayRow && c === displayCol);

                    const square = document.createElement('div');
                    square.className = 'chess-square';
                    square.style.backgroundColor = isLight ? '#fef3c7' : '#92400e';
                    if (isSelected) square.style.backgroundColor = '#fbbf24';
                    
                    square.onclick = () => handleSquareClick(displayRow, displayCol);

                    if (piece) {
                        const pieceElement = document.createElement('span');
                        pieceElement.className = 'chess-piece';
                        pieceElement.textContent = PIECE_SYMBOLS[piece.color][piece.type];
                        pieceElement.style.color = piece.color === 'white' ? 'white' : 'black';
                        pieceElement.style.textShadow = piece.color === 'white' 
                            ? '0 0 2px rgba(0,0,0,1)' 
                            : '0 0 2px rgba(255,255,255,0.8)';
                        square.appendChild(pieceElement);
                    }

                    if (isValidMove) {
                        const moveIndicator = document.createElement('div');
                        moveIndicator.className = 'valid-move';
                        square.appendChild(moveIndicator);
                    }

                    boardElement.appendChild(square);
                }
            }
        }

        function handleSquareClick(row, col) {
            if (promotionSquare) return;

            const piece = board[row][col];
            
            if (selectedSquare) {
                const [fromRow, fromCol] = selectedSquare;
                const movingPiece = board[fromRow][fromCol];

                if (movingPiece) {
                    const canMove = validMoves.some(([r, c]) => r === row && c === col);

                    if (canMove) {
                        const newBoard = board.map(r => [...r]);
                        newBoard[row][col] = movingPiece;
                        newBoard[fromRow][fromCol] = null;

                        // Check for pawn promotion
                        if (movingPiece.type === "pawn" && (row === 0 || row === 7)) {
                            promotionSquare = { row, col };
                            board = newBoard;
                            document.getElementById('promotionDialog').classList.remove('hidden');
                            selectedSquare = null;
                            validMoves = [];
                            renderBoard();
                            return;
                        }

                        board = newBoard;
                        currentPlayer = currentPlayer === "white" ? "black" : "white";
                        selectedSquare = null;
                        validMoves = [];
                        updateGameStatus();
                        renderBoard();
                        return;
                    }
                }
            }

            if (piece && piece.color === currentPlayer) {
                selectedSquare = [row, col];
                validMoves = getValidMoves(board, row, col);
            } else {
                selectedSquare = null;
                validMoves = [];
            }
            
            renderBoard();
        }

        function promotePiece(pieceType) {
            if (!promotionSquare) return;

            const { row, col } = promotionSquare;
            const promotingPiece = board[row][col];

            if (promotingPiece) {
                board[row][col] = { type: pieceType, color: promotingPiece.color };
                currentPlayer = currentPlayer === "white" ? "black" : "white";
            }

            promotionSquare = null;
            document.getElementById('promotionDialog').classList.add('hidden');
            updateGameStatus();
            renderBoard();
        }

        function resetBoard() {
            board = createInitialBoard();
            currentPlayer = 'white';
            selectedSquare = null;
            validMoves = [];
            promotionSquare = null;
            document.getElementById('promotionDialog').classList.add('hidden');
            updateGameStatus();
            renderBoard();
        }

        function flipBoard() {
            isFlipped = !isFlipped;
            renderBoard();
        }

        function updateGameStatus() {
            const statusElement = document.getElementById('gameStatus');
            statusElement.textContent = `${currentPlayer === 'white' ? 'White' : 'Black'} to move`;
        }

        // Initialize the game
        board = createInitialBoard();
        renderBoard();
    </script>
</body>
</html>
